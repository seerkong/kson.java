(begin
    (func run (v1 v2)
        (write_line "run perform start")
        (let temp (perform add (v1 v2)))
        (write_line "after perform add (v1 v2)")
        (let result (perform multi (temp 2)))
        (write_line "after perform multi (temp 2)")
        (write_line "run perform end")
        result
    )
    (let result)
    (try
        (begin
            (set result (run 1 2))
        )
        (handle add (v1 v2)
            (set_timeout
                (func ()
                    (write_line "before resume (+ v1 v2)")
                    (resume (+ v1 v2))
                    (write_line "should not go here")
                )
                1000
            )
        )
        (handle multi (v1 v2)
            (set_timeout
                (func ()
                    (write_line "before resume (* v1 v2)")
                    (resume (* v1 v2))
                    (write_line "should not go here")
                )
                1000
            )

        )
    )
    (write_line "after try")
    result
)


(func run (v1 v2)
    (write_line "run start")
    (let temp (perform add (v1 v2)))
    (let result (perform multi (temp 2)))
    (write_line "run end")
    result
)
(try
    (begin
        (run 1 2)
    )
    (handle add (v1 v2)
        (set_timeout (func () (resume (+ v1 v2))) 1000)
    )
    (handle multi (v1 v2)
        (set_timeout (func () (resume (* v1 v2))) 2000)
    )
)